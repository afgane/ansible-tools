---

- name: Copy the bootstrap user management script
  copy: src=manage_bootstrap_user.py dest={{ galaxy_server_dir }}/manage_bootstrap_user.py owner={{ galaxy_user_name }}

- name: Create Galaxy bootstrap user
  command: chdir={{ galaxy_server_dir }} {{ galaxy_venv_dir }}/bin/python manage_bootstrap_user.py -c {{ galaxy_config_file }} create -e {{ galaxy_tools_admin_user }} -p {{ galaxy_tools_admin_user_password }}
  register: api_key
  when: galaxy_tools_create_bootstrap_user

- name: Set bootstrap user as Galaxy Admin
  lineinfile: dest={{ galaxy_config_file }} state=present insertafter="app:main" regexp="admin_users =" line="admin_users = {{ galaxy_tools_admin_user }}"  #"
  when: galaxy_tools_create_bootstrap_user

- include: restart_galaxy.yml

- set_fact: galaxy_tools_api_key="{{ api_key.stdout_lines[0] }}"  #"
  when: galaxy_tools_create_bootstrap_user

